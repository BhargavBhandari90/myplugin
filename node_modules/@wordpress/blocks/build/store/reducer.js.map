{"version":3,"sources":["@wordpress/blocks/src/store/reducer.js"],"names":["DEFAULT_CATEGORIES","slug","title","unprocessedBlockTypes","state","action","type","blockType","name","names","blockTypes","blockStyles","map","style","source","filter","blockName","styles","styleNames","indexOf","blockVariations","variation","variations","variationNames","createBlockNameSetterReducer","setActionType","defaultBlockName","freeformFallbackBlockName","unregisteredFallbackBlockName","groupingBlockName","categories","category","categoryToChange","collections","namespace","icon"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tfilter,\n\tfind,\n\tget,\n\tisEmpty,\n\tkeyBy,\n\tmap,\n\tmapValues,\n\tomit,\n\tuniqBy,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { combineReducers } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * @typedef {Object} WPBlockCategory\n *\n * @property {string} slug  Unique category slug.\n * @property {string} title Category label, for display in user interface.\n */\n\n/**\n * Default set of categories.\n *\n * @type {WPBlockCategory[]}\n */\nexport const DEFAULT_CATEGORIES = [\n\t{ slug: 'text', title: __( 'Text' ) },\n\t{ slug: 'media', title: __( 'Media' ) },\n\t{ slug: 'design', title: __( 'Design' ) },\n\t{ slug: 'widgets', title: __( 'Widgets' ) },\n\t{ slug: 'theme', title: __( 'Theme' ) },\n\t{ slug: 'embed', title: __( 'Embeds' ) },\n\t{ slug: 'reusable', title: __( 'Reusable blocks' ) },\n];\n\n/**\n * Reducer managing the unprocessed block types in a form passed when registering the by block.\n * It's for internal use only. It allows recomputing the processed block types on-demand after block type filters\n * get added or removed.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function unprocessedBlockTypes( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_UNPROCESSED_BLOCK_TYPE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockType.name ]: action.blockType,\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_TYPES':\n\t\t\treturn omit( state, action.names );\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing the processed block types with all filters applied.\n * The state is derived from the `unprocessedBlockTypes` reducer.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockTypes( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...keyBy( action.blockTypes, 'name' ),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_TYPES':\n\t\t\treturn omit( state, action.names );\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing the block style variations.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockStyles( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...mapValues(\n\t\t\t\t\tkeyBy( action.blockTypes, 'name' ),\n\t\t\t\t\t( blockType ) => {\n\t\t\t\t\t\treturn uniqBy(\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t...get( blockType, [ 'styles' ], [] ).map(\n\t\t\t\t\t\t\t\t\t( style ) => ( {\n\t\t\t\t\t\t\t\t\t\t...style,\n\t\t\t\t\t\t\t\t\t\tsource: 'block',\n\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t...get( state, [ blockType.name ], [] ).filter(\n\t\t\t\t\t\t\t\t\t( { source } ) => 'block' !== source\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t( style ) => style.name\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'ADD_BLOCK_STYLES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: uniqBy(\n\t\t\t\t\t[\n\t\t\t\t\t\t...get( state, [ action.blockName ], [] ),\n\t\t\t\t\t\t...action.styles,\n\t\t\t\t\t],\n\t\t\t\t\t( style ) => style.name\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_STYLES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: filter(\n\t\t\t\t\tget( state, [ action.blockName ], [] ),\n\t\t\t\t\t( style ) => action.styleNames.indexOf( style.name ) === -1\n\t\t\t\t),\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing the block variations.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockVariations( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...mapValues(\n\t\t\t\t\tkeyBy( action.blockTypes, 'name' ),\n\t\t\t\t\t( blockType ) => {\n\t\t\t\t\t\treturn uniqBy(\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t...get( blockType, [ 'variations' ], [] ).map(\n\t\t\t\t\t\t\t\t\t( variation ) => ( {\n\t\t\t\t\t\t\t\t\t\t...variation,\n\t\t\t\t\t\t\t\t\t\tsource: 'block',\n\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t...get( state, [ blockType.name ], [] ).filter(\n\t\t\t\t\t\t\t\t\t( { source } ) => 'block' !== source\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t( variation ) => variation.name\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'ADD_BLOCK_VARIATIONS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: uniqBy(\n\t\t\t\t\t[\n\t\t\t\t\t\t...get( state, [ action.blockName ], [] ),\n\t\t\t\t\t\t...action.variations,\n\t\t\t\t\t],\n\t\t\t\t\t( variation ) => variation.name\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_VARIATIONS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: filter(\n\t\t\t\t\tget( state, [ action.blockName ], [] ),\n\t\t\t\t\t( variation ) =>\n\t\t\t\t\t\taction.variationNames.indexOf( variation.name ) === -1\n\t\t\t\t),\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Higher-order Reducer creating a reducer keeping track of given block name.\n *\n * @param {string} setActionType Action type.\n *\n * @return {Function} Reducer.\n */\nexport function createBlockNameSetterReducer( setActionType ) {\n\treturn ( state = null, action ) => {\n\t\tswitch ( action.type ) {\n\t\t\tcase 'REMOVE_BLOCK_TYPES':\n\t\t\t\tif ( action.names.indexOf( state ) !== -1 ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn state;\n\n\t\t\tcase setActionType:\n\t\t\t\treturn action.name || null;\n\t\t}\n\n\t\treturn state;\n\t};\n}\n\nexport const defaultBlockName = createBlockNameSetterReducer(\n\t'SET_DEFAULT_BLOCK_NAME'\n);\nexport const freeformFallbackBlockName = createBlockNameSetterReducer(\n\t'SET_FREEFORM_FALLBACK_BLOCK_NAME'\n);\nexport const unregisteredFallbackBlockName = createBlockNameSetterReducer(\n\t'SET_UNREGISTERED_FALLBACK_BLOCK_NAME'\n);\nexport const groupingBlockName = createBlockNameSetterReducer(\n\t'SET_GROUPING_BLOCK_NAME'\n);\n\n/**\n * Reducer managing the categories\n *\n * @param {WPBlockCategory[]} state  Current state.\n * @param {Object}            action Dispatched action.\n *\n * @return {WPBlockCategory[]} Updated state.\n */\nexport function categories( state = DEFAULT_CATEGORIES, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'SET_CATEGORIES':\n\t\t\treturn action.categories || [];\n\t\tcase 'UPDATE_CATEGORY': {\n\t\t\tif ( ! action.category || isEmpty( action.category ) ) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\tconst categoryToChange = find( state, [ 'slug', action.slug ] );\n\t\t\tif ( categoryToChange ) {\n\t\t\t\treturn map( state, ( category ) => {\n\t\t\t\t\tif ( category.slug === action.slug ) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...category,\n\t\t\t\t\t\t\t...action.category,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn category;\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\treturn state;\n}\n\nexport function collections( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_COLLECTION':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.namespace ]: {\n\t\t\t\t\ttitle: action.title,\n\t\t\t\t\ticon: action.icon,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_COLLECTION':\n\t\t\treturn omit( state, action.namespace );\n\t}\n\treturn state;\n}\n\nexport default combineReducers( {\n\tunprocessedBlockTypes,\n\tblockTypes,\n\tblockStyles,\n\tblockVariations,\n\tdefaultBlockName,\n\tfreeformFallbackBlockName,\n\tunregisteredFallbackBlockName,\n\tgroupingBlockName,\n\tcategories,\n\tcollections,\n} );\n"]}