{"version":3,"sources":["@wordpress/blocks/src/api/raw-handling/image-corrector.js"],"names":["createBlobURL","atob","File","window","imageCorrector","node","nodeName","src","indexOf","properties","data","split","type","slice","decoded","e","uint8Array","Uint8Array","length","i","charCodeAt","name","replace","file","height","width","parentNode","removeChild"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,aAAT,QAA8B,iBAA9B;AAEA;AACA;AACA;;AACA,MAAM;AAAEC,EAAAA,IAAF;AAAQC,EAAAA;AAAR,IAAiBC,MAAvB;AAEA,eAAe,SAASC,cAAT,CAAyBC,IAAzB,EAAgC;AAC9C,MAAKA,IAAI,CAACC,QAAL,KAAkB,KAAvB,EAA+B;AAC9B;AACA;;AAED,MAAKD,IAAI,CAACE,GAAL,CAASC,OAAT,CAAkB,OAAlB,MAAgC,CAArC,EAAyC;AACxCH,IAAAA,IAAI,CAACE,GAAL,GAAW,EAAX;AACA,GAP6C,CAS9C;;;AACA,MAAKF,IAAI,CAACE,GAAL,CAASC,OAAT,CAAkB,OAAlB,MAAgC,CAArC,EAAyC;AACxC,UAAM,CAAEC,UAAF,EAAcC,IAAd,IAAuBL,IAAI,CAACE,GAAL,CAASI,KAAT,CAAgB,GAAhB,CAA7B;AACA,UAAM,CAAEC,IAAF,IAAWH,UAAU,CAACI,KAAX,CAAkB,CAAlB,EAAsBF,KAAtB,CAA6B,GAA7B,CAAjB;;AAEA,QAAK,CAAED,IAAF,IAAU,CAAEE,IAAjB,EAAwB;AACvBP,MAAAA,IAAI,CAACE,GAAL,GAAW,EAAX;AACA;AACA;;AAED,QAAIO,OAAJ,CATwC,CAWxC;;AACA,QAAI;AACHA,MAAAA,OAAO,GAAGb,IAAI,CAAES,IAAF,CAAd;AACA,KAFD,CAEE,OAAQK,CAAR,EAAY;AACbV,MAAAA,IAAI,CAACE,GAAL,GAAW,EAAX;AACA;AACA;;AAED,UAAMS,UAAU,GAAG,IAAIC,UAAJ,CAAgBH,OAAO,CAACI,MAAxB,CAAnB;;AAEA,SAAM,IAAIC,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGH,UAAU,CAACE,MAAhC,EAAwCC,CAAC,EAAzC,EAA8C;AAC7CH,MAAAA,UAAU,CAAEG,CAAF,CAAV,GAAkBL,OAAO,CAACM,UAAR,CAAoBD,CAApB,CAAlB;AACA;;AAED,UAAME,IAAI,GAAGT,IAAI,CAACU,OAAL,CAAc,GAAd,EAAmB,GAAnB,CAAb;AACA,UAAMC,IAAI,GAAG,IAAIrB,IAAJ,CAAU,CAAEc,UAAF,CAAV,EAA0BK,IAA1B,EAAgC;AAAET,MAAAA;AAAF,KAAhC,CAAb;AAEAP,IAAAA,IAAI,CAACE,GAAL,GAAWP,aAAa,CAAEuB,IAAF,CAAxB;AACA,GAvC6C,CAyC9C;;;AACA,MAAKlB,IAAI,CAACmB,MAAL,KAAgB,CAAhB,IAAqBnB,IAAI,CAACoB,KAAL,KAAe,CAAzC,EAA6C;AAC5CpB,IAAAA,IAAI,CAACqB,UAAL,CAAgBC,WAAhB,CAA6BtB,IAA7B;AACA;AACD","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { createBlobURL } from '@wordpress/blob';\n\n/**\n * Browser dependencies\n */\nconst { atob, File } = window;\n\nexport default function imageCorrector( node ) {\n\tif ( node.nodeName !== 'IMG' ) {\n\t\treturn;\n\t}\n\n\tif ( node.src.indexOf( 'file:' ) === 0 ) {\n\t\tnode.src = '';\n\t}\n\n\t// This piece cannot be tested outside a browser env.\n\tif ( node.src.indexOf( 'data:' ) === 0 ) {\n\t\tconst [ properties, data ] = node.src.split( ',' );\n\t\tconst [ type ] = properties.slice( 5 ).split( ';' );\n\n\t\tif ( ! data || ! type ) {\n\t\t\tnode.src = '';\n\t\t\treturn;\n\t\t}\n\n\t\tlet decoded;\n\n\t\t// Can throw DOMException!\n\t\ttry {\n\t\t\tdecoded = atob( data );\n\t\t} catch ( e ) {\n\t\t\tnode.src = '';\n\t\t\treturn;\n\t\t}\n\n\t\tconst uint8Array = new Uint8Array( decoded.length );\n\n\t\tfor ( let i = 0; i < uint8Array.length; i++ ) {\n\t\t\tuint8Array[ i ] = decoded.charCodeAt( i );\n\t\t}\n\n\t\tconst name = type.replace( '/', '.' );\n\t\tconst file = new File( [ uint8Array ], name, { type } );\n\n\t\tnode.src = createBlobURL( file );\n\t}\n\n\t// Remove trackers and hardly visible images.\n\tif ( node.height === 1 || node.width === 1 ) {\n\t\tnode.parentNode.removeChild( node );\n\t}\n}\n"]}