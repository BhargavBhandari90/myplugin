{"version":3,"sources":["@wordpress/blocks/src/api/raw-handling/special-comment-converter.js"],"names":["remove","replace","specialCommentConverter","node","doc","nodeType","COMMENT_NODE","nodeValue","createNextpage","indexOf","customText","slice","trim","sibling","noTeaser","nextSibling","createMore","createElement","dataset","block"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAT,EAAiBC,OAAjB,QAAgC,gBAAhC;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAe,SAASC,uBAAT,CAAkCC,IAAlC,EAAwCC,GAAxC,EAA8C;AAC5D,MAAKD,IAAI,CAACE,QAAL,KAAkBF,IAAI,CAACG,YAA5B,EAA2C;AAC1C;AACA;;AAED,MAAKH,IAAI,CAACI,SAAL,KAAmB,UAAxB,EAAqC;AACpCN,IAAAA,OAAO,CAAEE,IAAF,EAAQK,cAAc,CAAEJ,GAAF,CAAtB,CAAP;AACA;AACA;;AAED,MAAKD,IAAI,CAACI,SAAL,CAAeE,OAAf,CAAwB,MAAxB,MAAqC,CAA1C,EAA8C;AAC7C;AACA,UAAMC,UAAU,GAAGP,IAAI,CAACI,SAAL,CAAeI,KAAf,CAAsB,CAAtB,EAA0BC,IAA1B,EAAnB;AAEA;AACF;AACA;AACA;AACA;;AACE,QAAIC,OAAO,GAAGV,IAAd;AACA,QAAIW,QAAQ,GAAG,KAAf;;AACA,WAAUD,OAAO,GAAGA,OAAO,CAACE,WAA5B,EAA4C;AAC3C,UACCF,OAAO,CAACR,QAAR,KAAqBQ,OAAO,CAACP,YAA7B,IACAO,OAAO,CAACN,SAAR,KAAsB,UAFvB,EAGE;AACDO,QAAAA,QAAQ,GAAG,IAAX;AACAd,QAAAA,MAAM,CAAEa,OAAF,CAAN;AACA;AACA;AACD;;AAEDZ,IAAAA,OAAO,CAAEE,IAAF,EAAQa,UAAU,CAAEN,UAAF,EAAcI,QAAd,EAAwBV,GAAxB,CAAlB,CAAP;AACA;AACD;;AAED,SAASY,UAAT,CAAqBN,UAArB,EAAiCI,QAAjC,EAA2CV,GAA3C,EAAiD;AAChD,QAAMD,IAAI,GAAGC,GAAG,CAACa,aAAJ,CAAmB,UAAnB,CAAb;AACAd,EAAAA,IAAI,CAACe,OAAL,CAAaC,KAAb,GAAqB,WAArB;;AACA,MAAKT,UAAL,EAAkB;AACjBP,IAAAA,IAAI,CAACe,OAAL,CAAaR,UAAb,GAA0BA,UAA1B;AACA;;AACD,MAAKI,QAAL,EAAgB;AACf;AACAX,IAAAA,IAAI,CAACe,OAAL,CAAaJ,QAAb,GAAwB,EAAxB;AACA;;AACD,SAAOX,IAAP;AACA;;AAED,SAASK,cAAT,CAAyBJ,GAAzB,EAA+B;AAC9B,QAAMD,IAAI,GAAGC,GAAG,CAACa,aAAJ,CAAmB,UAAnB,CAAb;AACAd,EAAAA,IAAI,CAACe,OAAL,CAAaC,KAAb,GAAqB,eAArB;AAEA,SAAOhB,IAAP;AACA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { remove, replace } from '@wordpress/dom';\n\n/**\n * Looks for `<!--nextpage-->` and `<!--more-->` comments, as well as the\n * `<!--more Some text-->` variant and its `<!--noteaser-->` companion,\n * and replaces them with a custom element representing a future block.\n *\n * The custom element is a way to bypass the rest of the `raw-handling`\n * transforms, which would eliminate other kinds of node with which to carry\n * `<!--more-->`'s data: nodes with `data` attributes, empty paragraphs, etc.\n *\n * The custom element is then expected to be recognized by any registered\n * block's `raw` transform.\n *\n * @param {Node}     node The node to be processed.\n * @param {Document} doc  The document of the node.\n * @return {void}\n */\nexport default function specialCommentConverter( node, doc ) {\n\tif ( node.nodeType !== node.COMMENT_NODE ) {\n\t\treturn;\n\t}\n\n\tif ( node.nodeValue === 'nextpage' ) {\n\t\treplace( node, createNextpage( doc ) );\n\t\treturn;\n\t}\n\n\tif ( node.nodeValue.indexOf( 'more' ) === 0 ) {\n\t\t// Grab any custom text in the comment.\n\t\tconst customText = node.nodeValue.slice( 4 ).trim();\n\n\t\t/*\n\t\t * When a `<!--more-->` comment is found, we need to look for any\n\t\t * `<!--noteaser-->` sibling, but it may not be a direct sibling\n\t\t * (whitespace typically lies in between)\n\t\t */\n\t\tlet sibling = node;\n\t\tlet noTeaser = false;\n\t\twhile ( ( sibling = sibling.nextSibling ) ) {\n\t\t\tif (\n\t\t\t\tsibling.nodeType === sibling.COMMENT_NODE &&\n\t\t\t\tsibling.nodeValue === 'noteaser'\n\t\t\t) {\n\t\t\t\tnoTeaser = true;\n\t\t\t\tremove( sibling );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treplace( node, createMore( customText, noTeaser, doc ) );\n\t}\n}\n\nfunction createMore( customText, noTeaser, doc ) {\n\tconst node = doc.createElement( 'wp-block' );\n\tnode.dataset.block = 'core/more';\n\tif ( customText ) {\n\t\tnode.dataset.customText = customText;\n\t}\n\tif ( noTeaser ) {\n\t\t// \"Boolean\" data attribute.\n\t\tnode.dataset.noTeaser = '';\n\t}\n\treturn node;\n}\n\nfunction createNextpage( doc ) {\n\tconst node = doc.createElement( 'wp-block' );\n\tnode.dataset.block = 'core/nextpage';\n\n\treturn node;\n}\n"]}